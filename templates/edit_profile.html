{% extends "base.html" %}

{% block title %}Edit Profile - Uzbek Global Network{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white text-center">
                <h4 class="mb-0"><i class="fas fa-user-edit me-2"></i>{{ _('Edit Profile') }}</h4>
            </div>
            <div class="card-body p-4">
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                                <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }} me-2"></i>
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form method="POST" enctype="multipart/form-data" id="editProfileForm">
                    {% if user.user_type == 'member' %}
                    <!-- Member Basic Information -->
                    <h5 class="mb-3 text-primary"><i class="fas fa-user me-2"></i>{{ _('Basic Information') }}</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="full_name" class="form-label">{{ _('Full Name') }}</label>
                            <input type="text" class="form-control" id="full_name" name="full_name" 
                                   value="{{ user.full_name or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="phone" class="form-label">{{ _('Phone Number') }}</label>
                            <input type="tel" class="form-control" id="phone" name="phone" 
                                   value="{{ user.phone or '' }}" placeholder="+998 (00) 000 00 00">
                        </div>
                    </div>
                    {% elif user.user_type == 'company' %}
                    <!-- Company Basic Information -->
                    <h5 class="mb-3 text-warning"><i class="fas fa-building me-2"></i>{{ _('Company Information') }}</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="company_name" class="form-label">{{ _('Company Name') }}</label>
                            <input type="text" class="form-control" id="company_name" name="company_name" 
                                   value="{{ user.company_name or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="company_country" class="form-label">{{ _('Country') }}</label>
                            <input type="text" class="form-control" id="company_country" name="company_country" 
                                   value="{{ user.company_country or '' }}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="industry" class="form-label">{{ _('Industry') }}</label>
                            <input type="text" class="form-control" id="industry" name="industry" 
                                   value="{{ user.industry or '' }}" placeholder="e.g., Technology, Finance, Healthcare">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="phone" class="form-label">{{ _('Phone Number') }}</label>
                            <input type="tel" class="form-control" id="phone" name="phone" 
                                   value="{{ user.phone or '' }}" placeholder="+998 (00) 000 00 00">
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="mb-3">
                        <label for="bio" class="form-label">{{ _('Bio') }}</label>
                        <textarea class="form-control" id="bio" name="bio" rows="3" 
                                  placeholder="{{ _('Tell us about yourself...') }}">{{ user.bio or '' }}</textarea>
                    </div>

                    <!-- Profile Photo/Logo -->
                    {% if user.user_type == 'member' %}
                    <h5 class="mb-3 text-primary"><i class="fas fa-camera me-2"></i>{{ _('Profile Photo') }}</h5>
                    {% else %}
                    <h5 class="mb-3 text-warning"><i class="fas fa-building me-2"></i>{{ _('Company Logo') }}</h5>
                    {% endif %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {% if user.user_type == 'member' %}
                            <label for="photo" class="form-label">{{ _('Upload New Photo') }}</label>
                            <input type="file" class="form-control" id="photo" name="photo" accept="image/*">
                            {% else %}
                            <label for="logo" class="form-label">{{ _('Upload New Logo') }}</label>
                            <input type="file" class="form-control" id="logo" name="logo" accept="image/*">
                            {% endif %}
                            <div class="form-text">{{ _('PNG, JPG, JPEG, GIF (max 16MB)') }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            {% if user.photo_filename %}
                                <label class="form-label">{{ _('Current Photo') }}</label>
                                <div>
                                    <img src="{{ url_for('static', filename='uploads/' + user.photo_filename) }}" 
                                         alt="Current Photo" class="img-thumbnail" style="max-width: 150px;">
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Social Media Section -->
                    <h5 class="mb-3 text-primary"><i class="fas fa-share-alt me-2"></i>{{ _('Social Media & Links') }}</h5>
                    
                    <div class="mb-3">
                        <button type="button" class="btn btn-outline-primary" id="addSocialMedia">
                            <i class="fas fa-plus me-2"></i>{{ _('Add Social Media') }}
                        </button>
                    </div>
                    
                    <div id="socialMediaFields" style="display: none;">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="linkedin_url" class="form-label">
                                    <i class="fab fa-linkedin text-primary me-2"></i>{{ _('LinkedIn') }}
                                </label>
                                <input type="url" class="form-control" id="linkedin_url" name="linkedin_url" 
                                       value="{{ user.linkedin_url or '' }}" placeholder="https://linkedin.com/in/yourprofile">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="instagram_url" class="form-label">
                                    <i class="fab fa-instagram text-danger me-2"></i>{{ _('Instagram') }}
                                </label>
                                <input type="url" class="form-control" id="instagram_url" name="instagram_url" 
                                       value="{{ user.instagram_url or '' }}" placeholder="https://instagram.com/yourprofile">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="x_twitter_url" class="form-label">
                                    <i class="fab fa-x-twitter text-dark me-2"></i>{{ _('X (Twitter)') }}
                                </label>
                                <input type="url" class="form-control" id="x_twitter_url" name="x_twitter_url" 
                                       value="{{ user.x_twitter_url or '' }}" placeholder="https://x.com/yourprofile">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="telegram_url" class="form-label">
                                    <i class="fab fa-telegram text-info me-2"></i>{{ _('Telegram') }}
                                </label>
                                <input type="url" class="form-control" id="telegram_url" name="telegram_url" 
                                       value="{{ user.telegram_url or '' }}" placeholder="https://t.me/yourprofile">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="github_url" class="form-label">
                                    <i class="fab fa-github text-dark me-2"></i>{{ _('GitHub') }}
                                </label>
                                <input type="url" class="form-control" id="github_url" name="github_url" 
                                       value="{{ user.github_url or '' }}" placeholder="https://github.com/yourprofile">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="personal_website" class="form-label">
                                    <i class="fas fa-globe text-success me-2"></i>{{ _('Personal Website') }}
                                </label>
                                <input type="url" class="form-control" id="personal_website" name="personal_website" 
                                       value="{{ user.personal_website or '' }}" placeholder="https://yourwebsite.com">
                            </div>
                        </div>
                    </div>

                    <!-- CV Upload (Members only) -->
                    {% if user.user_type == 'member' %}
                    <h5 class="mb-3 text-primary"><i class="fas fa-file-pdf me-2"></i>{{ _('CV/Resume') }}</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="cv" class="form-label">{{ _('Upload CV/Resume') }}</label>
                            <input type="file" class="form-control" id="cv" name="cv" accept=".pdf,.doc,.docx">
                            <div class="form-text">{{ _('PDF, DOC, DOCX (max 16MB)') }}</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            {% if user.cv_filename %}
                                <label class="form-label">{{ _('Current CV') }}</label>
                                <div>
                                    <a href="{{ url_for('static', filename='uploads/' + user.cv_filename) }}" 
                                       target="_blank" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-download me-2"></i>{{ _('Download Current CV') }}
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>{{ _('Back to Dashboard') }}
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>{{ _('Save Changes') }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const addSocialMediaBtn = document.getElementById('addSocialMedia');
    const socialMediaFields = document.getElementById('socialMediaFields');
    
    // Check if any social media fields have values
    const socialFields = ['linkedin_url', 'instagram_url', 'x_twitter_url', 'telegram_url', 'github_url', 'personal_website'];
    const hasSocialData = socialFields.some(field => {
        const input = document.getElementById(field);
        return input && input.value.trim() !== '';
    });
    
    // Show social media fields if they have data or if button is clicked
    if (hasSocialData) {
        socialMediaFields.style.display = 'block';
        addSocialMediaBtn.style.display = 'none';
    }
    
    addSocialMediaBtn.addEventListener('click', function() {
        socialMediaFields.style.display = 'block';
        this.style.display = 'none';
    });
    
    // Form validation
    const form = document.getElementById('editProfileForm');
    form.addEventListener('submit', function(event) {
        const fullName = document.getElementById('full_name').value.trim();
        
        if (!fullName) {
            event.preventDefault();
            alert('Full name is required');
            return false;
        }
    });
    
    // Auto-hide alerts after 5 seconds
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(function(alert) {
        setTimeout(function() {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        }, 5000);
    });
});
</script>
{% endblock %}
